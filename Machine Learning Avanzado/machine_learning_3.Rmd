---
title: "Taller 3 de Machine Learning Avanzado"
author: 
  - Araneda F., Marcela
  - Reyes G., Álvaro
  - Sepúlveda M., Danilo
  - Zegpi D., Diabb
output: 
  html_document:
    theme: united
    highlight: kate
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
ragg_png = function(..., res = 500) {
  ragg::agg_png(..., res = res, units = "in")
}

knitr::opts_chunk$set(
  echo = TRUE, 
  class.output = "purple-output",
  dev = "ragg_png", 
  fig.align = "center"
)
```

<style>
  body {
    font-size: 16px;
    background-color: #fff9fa;
  }
  
  pre {
    border: 0px;
  }

  .sourceCode, code {
    font-family: 'Fira Mono';
  }
  
  code {
    background-color: #e5eeeb;
    color: #111;
  }
  
  pre.sourceCode {
    color: #111;
    font-weight: 500;
    background-color: #e5eeeb;
  }
  
  code span.fu {
    color: #0e4747;
    font-weight: 600;
  }
  
  code span.sc {
    color: #ae4d00;
    font-weight: 600;
  }
  
  code span.st {
    color: #ae4d00;
  }
  
  .purple-output{
    background-color: #012626;
    color: #eee;
  }
</style>


```{r warning=FALSE, message=FALSE}
# Dependencias 
# install.packages(c("tidyverse", "tidymodels","here", "janitor", reticulate", "keras"))

library(tidyverse)
library(tidymodels)
library(here)
startup_raw <- read_csv(file = here("Machine Learning Avanzado", "startup data.csv")) %>% 
  janitor::clean_names()
```


```{r echo=FALSE}
library(ggtext)
theme_set(theme_light(base_family = "Segoe UI", base_size = 16))
theme_update(
  plot.background = element_rect(fill = "#fff9fa", color = "transparent"),
  panel.background = element_rect(fill = "#eeeeee"),
  text = element_text(color = "#111111"),
  plot.title = element_markdown(hjust = .5),
  plot.subtitle = element_markdown(hjust = .5),
  strip.background = element_rect(fill = "#fff9fa"),
  strip.text = element_text(color = "#111111", face = "italic", size = "16")
)
```


El dataset `startup` registra información de empresas emergentes (startups) en Estados Unidos. En total, contiene 923 filas y 49 columnas. Cada fila representa a una startup y cada columna a una característica de ésta. Inicialmente, hay muchas columnas que pueden ser construidos a partir de éstas, causando así duplicidad de datos. Por tanto, el primer análisis consistirá en determinar cuáles columnas pueden ser excluidas del dataset sin perder información relevante.  


```{r}
startup <- startup_raw %>% 
  select(-c(unnamed_0, zip_code, id, unnamed_6, labels, closed_at, state_code_1, object_id),
         -starts_with("is_")) 

colnames(startup)
```


```{r}
skimr::skim(startup)
```

El dataset resultante tiene `ncol(startup)` columnas, `select(startup, where(is.character)) %>% ncol()` de las cuales son categóricas y las demás son numéricas. De las columnas categóricas, 3 corresponden a fechas, por lo que se procede a adaptarlas.


```{r}
startup <- startup %>% 
  mutate(across(
    matches("fo?und") & where(is.character),
    function(x) as.Date(x, format = "%m/%d/%Y")            
  )) 
```


A continuación, se exploran descriptivamente todas las variables, de acuerdo con us tipo de dato.

### Variables categóricas
- No hay *missing data* en las columnas categóricas. 
- Las empresas provienen de 35 estados; el 52,9% es de California (CA).
- En total son 221 ciudades. San Francisco tiene la primera mayoría (13,9%).
- Las startups se dedican a 35 rubros. Las dos grandes mayorías son software (16,6%) y web (15,6%).
- Existe desequilibrio entre las dos clases de la variable objetivo `status`: acquired (64,7%) y closed (35,3%).


### Variables fecha
- Las empresas fueron fundadas entre el 1 de enero de 1984 y el 16 de abirl de 2013.
- Todas las empresas obtuvieron su primer financiamiento entre enero del 2000 y noviembre del 2013.
- Todas las empresas obtuvieron su último financiamiento entre enero del 2001 y noviembre del 2013.


## Variables numéricas
- La antigüedad de la empresa hasta su primer y último


```{r echo=FALSE, message=FALSE, warning=FALSE}
library(maps)
main_states <- map_data("state")
ggplot() +
  geom_polygon(data = main_states, aes(long, lat, group = group),
               fill = "#012626", color = "white", size = .1) +
  geom_point(data = startup, aes(longitude, latitude),
             inherit.aes = FALSE, fill = "gold3", size = 5, 
             alpha = .4, shape = 21, color = "gray30", stroke = 1) +
  coord_cartesian(xlim = c(-130, -65), ylim = c(23, 55)) +
  theme_void()
```


El mapa superior muestra las empresas registradas en USA. Solamente hay 4 empresas fuera de USA: Xelerated en el Mar Arábigo (Sureste de Omán), Moli, DiJiPOP y Tracelytics, las tres en el Océano Índico, al Este de Somalia. Por supuesto, las cuatro empresas se encuentran adscritas a ciudades estadounidenses, por lo que sus coordenadas son susceptibles a imputación. 


```{r}
startup %>% slice_max(latitude, n = 4) %>% select(state_code, city, longitude, latitude, name)
```





















